generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

generator dbml {
  provider = "prisma-dbml-generator"
}

datasource db {
  provider  = "postgresql"
  url       = env("DB_URL")
  directUrl = env("DB_URL_NON_POOLING")
}

// Enums
enum StepType {
  INFOGRAPHY
  ITEMS // TODO: cambiar por smart list
  CARD // TODO: cambiar por card grid
}

enum CardStrength {
  LOW
  MEDIUM
  HIGH
}

enum Color {
  RED
  PINK
  PURPLE
  YELLOW
  TAN
  ORANGE
  GREEN
  LIGHTBLUE
  BLUE
  DARKBLUE
}

// Models
model Round {
  id Int @id @default(autoincrement())

  link1 String? // TODO: use null default
  link2 String? // TODO: use null default

  categories Category[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Category {
  id Int @id @default(autoincrement())

  name String
  icon String

  roundId    Int
  round      Round       @relation(fields: [roundId], references: [id])
  attributes Attribute[]
  steps      Step[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Step {
  id Int @id @default(autoincrement())

  title       String
  description String?  @default("")  // TODO: use null default, explain why????
  icon        String
  position    Int // TODO: why we use this?, there is no task that needs this.
  type        StepType

  categoryId Int
  category   Category @relation(fields: [categoryId], references: [id])

  infographics Infographic[] // TODO: typo fixed
  items        Item[]
  cards        Card[]
  smartList    SmartList?   @relation(fields: [smartListId], references: [id])
  smartListId  Int?
  keywords     Keyword[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([position, categoryId])
  @@unique([title, categoryId])
}

model Infographic {
  id Int @id @default(autoincrement())

  markdown String
  image    String
  position Int // TODO: why we use this?, there is no task that needs this.

  stepId Int
  step   Step @relation(fields: [stepId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Item {
  id Int @id @default(autoincrement())

  markdown String
  position Int // TODO: why we use this?, there is no task that needs this.

  stepId      Int
  step        Step       @relation(fields: [stepId], references: [id])
  attributeId Int?
  attribute   Attribute? @relation(fields: [attributeId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Card {
  id Int @id @default(autoincrement())

  title    String
  markdown String
  strength CardStrength
  position Int // TODO: why we use this?, there is no task that needs this.

  stepId      Int
  step        Step       @relation(fields: [stepId], references: [id])
  attributeId Int?
  attribute   Attribute? @relation(fields: [attributeId], references: [id])
  keywords    Keyword[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Keyword {
  id Int @id @default(autoincrement())

  value String

  cards Card[]

  Step   Step @relation(fields: [stepId], references: [id])
  stepId Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([value, stepId])
}

model Attribute {
  id Int @id @default(autoincrement())

  value       String
  description String
  color       Color  @default(LIGHTBLUE)

  categoryId Int
  category   Category @relation(fields: [categoryId], references: [id])
  items      Item[]
  cards      Card[]

  smartList   SmartList @relation(fields: [smartListId], references: [id])
  smartListId Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model SmartList { // TODO: raname this, in this project Smart List means something different
  id Int @id @default(autoincrement())

  title String

  attributes Attribute[]
  steps      Step[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model UserWhitelist {
  email       String   @id @unique()
  whiteListed Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
